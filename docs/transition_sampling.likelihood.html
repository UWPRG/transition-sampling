

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>transition_sampling.likelihood package &mdash; transition_sampling  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="transition_sampling.util package" href="transition_sampling.util.html" />
    <link rel="prev" title="transition_sampling.engines.gromacs package" href="transition_sampling.engines.gromacs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> transition_sampling
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="workflow/workflow.html">Transition Sampling Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="input/input.html">Using transition_sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="input/input.html#inputs-yml-format"><code class="docutils literal notranslate"><span class="pre">inputs.yml</span></code> Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="engines/engines.html">MD Engines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="transition_sampling.html">transition_sampling package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="transition_sampling.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="transition_sampling.algo.html">transition_sampling.algo package</a></li>
<li class="toctree-l3"><a class="reference internal" href="transition_sampling.colvar.html">transition_sampling.colvar package</a></li>
<li class="toctree-l3"><a class="reference internal" href="transition_sampling.engines.html">transition_sampling.engines package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">transition_sampling.likelihood package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-transition_sampling.likelihood.likelihood_max">transition_sampling.likelihood.likelihood_max module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-transition_sampling.likelihood.optimization">transition_sampling.likelihood.optimization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="#module-transition_sampling.likelihood">Module contents</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="transition_sampling.util.html">transition_sampling.util package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transition_sampling.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="transition_sampling.html#module-transition_sampling.driver">transition_sampling.driver module</a></li>
<li class="toctree-l2"><a class="reference internal" href="transition_sampling.html#module-transition_sampling">Module contents</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">transition_sampling</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="transition_sampling.html">transition_sampling package</a> &raquo;</li>
        
      <li>transition_sampling.likelihood package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/transition_sampling.likelihood.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="transition-sampling-likelihood-package">
<h1>transition_sampling.likelihood package<a class="headerlink" href="#transition-sampling-likelihood-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-transition_sampling.likelihood.likelihood_max">
<span id="transition-sampling-likelihood-likelihood-max-module"></span><h2>transition_sampling.likelihood.likelihood_max module<a class="headerlink" href="#module-transition_sampling.likelihood.likelihood_max" title="Permalink to this headline">¶</a></h2>
<p>Likelihood maximization of aimless shooting results.</p>
<dl class="py class">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.likelihood_max.</span></span><span class="sig-name descname"><span class="pre">Maximizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">colvars_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">csv_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">niter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_jac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class for finding the best reaction coordinate with likelihood maximization.</p>
<p>Utilizes the results of aimless shooting and colvar calculation to determine
the optimum reaction coordinate by maximizing the likelihood of accepted
being on a transition path and rejected states being off it. See
<cite>optimization.optimize</cite> for more details on the maximization.</p>
<p>This is used to iteratively perform the maximization for all combinations
of CVs starting from a single CV and going to longer combinations if
adding another yields a statistically significant increase in likelihood.
Construct an instance and call <cite>maximize</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>colvars_file</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – File path to the CVs calculated with plumed in the default format.</p></li>
<li><p><strong>csv_file</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – File path to the cvs generated by aimless shooting that corresponds to
the colvars_file</p></li>
<li><p><strong>niter</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">list</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]]) – Number of local optimizations to determine a global optimum. This can
either be a single integer or a list of integers with the same length
as the number of CVs. The list gives the number of optimizations to do
for each combination length - it may be beneficial to have less
iterations for higher lengths of CVs if the optimization becomes too
long</p></li>
<li><p><strong>use_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – If true, the analytical jacobian will be calculated and used in the
optimization. Usually results in some speedup.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer.colvars">
<span class="sig-name descname"><span class="pre">colvars</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer.colvars" title="Permalink to this definition">¶</a></dt>
<dd><p>A DataFrame of all the collective variables loaded from <cite>colvars_file</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer.metadata">
<span class="sig-name descname"><span class="pre">metadata</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer.metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>A DataFrame containing the metadata of each state in <cite>colvars_file</cite>,
specifically if each was accepted or not.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer.niter">
<span class="sig-name descname"><span class="pre">niter</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer.niter" title="Permalink to this definition">¶</a></dt>
<dd><p>how many local optimizations to do for each global optimization with
a given number of cvs. Length == # of cvs</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer.use_jac">
<span class="sig-name descname"><span class="pre">use_jac</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer.use_jac" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the analytical jacobian should be used in optimization</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If the number of states in the colvars_file != number of states in
    the csv_file</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.Maximizer.maximize">
<span class="sig-name descname"><span class="pre">maximize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_num_cvs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.Maximizer.maximize" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the combination of CVs that maximize the likelihood of this data.</p>
<p>Only adds more CVs if they result in a statistically significant
increase.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>max_num_cvs</strong> (<code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>]) – The maximum number of CVs in a combination to evaluate (inclusive).
If this number is reached before the statistical threshold for adding
new CVs is, this function returns early. Set to None to set no limit</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution" title="transition_sampling.likelihood.likelihood_max.MaximizerSolution"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaximizerSolution</span></code></a></p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>All values for each tested combination, as well as the maximum</em></p></li>
<li><p>significant combination. See <cite>MaximizerSolution</cite></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.likelihood_max.</span></span><span class="sig-name descname"><span class="pre">MaximizerSolution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">req_improvement</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Wrapper class to carry results for all tested combinations in maximization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>req_improvement</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – The required improvement of the objective function for an additional CV
to be added to max</p>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution.combinations">
<span class="sig-name descname"><span class="pre">combinations</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution.combinations" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary representing the solution to all tested combinations. The
first key indicates the length of the combination. Within that
dictionary, the keys are sets of CV combinations, with values being a
the SingleSolution representation of the optimization.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict[int: dict[frozenset: SingleSolution]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution.max">
<span class="sig-name descname"><span class="pre">max</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution.max" title="Permalink to this definition">¶</a></dt>
<dd><p>The solution that has the maximum likelihood while still being
significant as determined by <cite>req_improvement</cite> to add another CV</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#transition_sampling.likelihood.likelihood_max.SingleSolution" title="transition_sampling.likelihood.likelihood_max.SingleSolution">SingleSolution</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution.req_improvement">
<span class="sig-name descname"><span class="pre">req_improvement</span></span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution.req_improvement" title="Permalink to this definition">¶</a></dt>
<dd><p>The required improvement of the objective function for an additional CV
to be added to max</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution.to_csv">
<span class="sig-name descname"><span class="pre">to_csv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution.to_csv" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the contents to a CSV. Non-present CVs get a NaN weight.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code>) – The filename to write the CSV to. Will append if a file is already
present</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.MaximizerSolution.to_dataframe">
<span class="sig-name descname"><span class="pre">to_dataframe</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.MaximizerSolution.to_dataframe" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn the contents into a rectangular data frame, one row per combination</p>
<p>In order to keep a rectangular format, cvs that aren’t in a specific
combination get a weight of NaN. The objective function and all weights
are</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">DataFrame</span></code></p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>DataFrame with combination results as rows and columns of</em></p></li>
<li><p><em>[n_cvs, obj_val, p0, alpha0, &lt;weight of each CV&gt;]</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="transition_sampling.likelihood.likelihood_max.SingleSolution">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.likelihood_max.</span></span><span class="sig-name descname"><span class="pre">SingleSolution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">comb</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sol</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.likelihood_max.SingleSolution" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Carries the result of a single CV combination optimization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>comb</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>) – An ordered tuple of CVs that this solution represents</p></li>
<li><p><strong>obj</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – The objective function of this result</p></li>
<li><p><strong>sol</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – The optimized solution. An ordered array of
[<cite>p0</cite>, <cite>alpha0</cite>, <cite>coeffs_for_each_CV in comb</cite>]</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">See</span> <span class="pre">Parameters</span></span></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-transition_sampling.likelihood.optimization">
<span id="transition-sampling-likelihood-optimization-module"></span><h2>transition_sampling.likelihood.optimization module<a class="headerlink" href="#module-transition_sampling.likelihood.optimization" title="Permalink to this headline">¶</a></h2>
<p>Likelihood maximization to determine reaction coordinates from aimless shooting
results.</p>
<p>In all documentation below, <em>n</em> refers to the number of shooting points being
used as data and <em>m</em> refers to the number of collective variables contributing
to the reaction coordinate.</p>
<dl class="py function">
<dt class="sig sig-object py" id="transition_sampling.likelihood.optimization.calc_p">
<span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.optimization.</span></span><span class="sig-name descname"><span class="pre">calc_p</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p_0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r_jac</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.optimization.calc_p" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate P(TP|r) for reaction coordinate given a weights vector and
colvars. Also returns the jacobian if requested.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p_0</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>) – Constant multiplier</p></li>
<li><p><strong>r_vals</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – A length n vector of calculated reaction coordinates.</p></li>
<li><p><strong>r_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – If None, the jacobian will not be calculated. Otherwise, this should be
an (n x m + 2) matrix representing the jacobian of each r with respect
to each alpha. The 0 index column should be empty space. Columns 1:m+2
represent jacobians of the alphas</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>A tuple of two numpy arrays.</em></p></li>
<li><p><em>First term</em> – A length n vector of P(TP|r) for every r</p></li>
<li><p><em>Second term</em> – None if r_jac is None. Otherwise an (n x m + 2) matrix representing the
jacobian of each p with respect to all parameters. The columns are
ordered as p_0, alphas.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="transition_sampling.likelihood.optimization.calc_r">
<span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.optimization.</span></span><span class="sig-name descname"><span class="pre">calc_r</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alphas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colvars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calc_jac</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.optimization.calc_r" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate linear combination of reaction coordinates given a weights vector
and colvars matrix. Also returns the jacobian with respect to the alphas if
requested.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alphas</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – a length m+1 array where m is the number of collective variables being
analyzed. alphas[0] refers to the constant added term.</p></li>
<li><p><strong>colvars</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – an (n x m) matrix where n is the number of shooting points and m is
the number of collective variables.</p></li>
<li><p><strong>calc_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – True if the jacobian should be calculated and returned.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>A tuple of two numpy arrays.</em></p></li>
<li><p><em>First term</em> – A length n vector of calculated reaction coordinates, one for each
shooting point.</p></li>
<li><p><em>Second term</em> – None if <cite>calc_jac</cite> = False. Otherwise, an (n x m + 2) matrix
representing the jacobian of each  coordinate with respect to each
alpha. The 0 index column is empty space allocated for p_0 later on.
Columns 1:m+2 represent jacobians of the alphas</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="transition_sampling.likelihood.optimization.obj_func">
<span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.optimization.</span></span><span class="sig-name descname"><span class="pre">obj_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">to_opt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colvars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_accepted</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">calc_jac</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.optimization.obj_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Objective function to minimize for colvar maximization with fixed p_0</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>to_opt</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – Array of m+2 parameters to optimize. Convention is
- to_opt[0] : p_0 term
- to_opt[1] : alpha_0, i.e. the constant added weight
- to_opt[2:] : alphas_1…alphas_m for m collective variables.</p></li>
<li><p><strong>colvars</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – an (n x m) matrix where n is the number of shooting points and m is
the number of collective variables.</p></li>
<li><p><strong>is_accepted</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – A length n boolean np array corresponding to if the ith state in colvars
was accepted</p></li>
<li><p><strong>calc_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – True if the jacobian should be calculated and also returned</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>A tuple of float, numpy array.</em></p></li>
<li><p><em>First term</em> – The value to be <em>minimized</em> for likelihood maximization.</p></li>
<li><p><em>Second term</em> – None if calc_jac is None. Otherwise: an m+2 length array representing
the jacobian of the objective function for each optimized parameter</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="transition_sampling.likelihood.optimization.optimize">
<span class="sig-prename descclassname"><span class="pre">transition_sampling.likelihood.optimization.</span></span><span class="sig-name descname"><span class="pre">optimize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">colvars</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_accepted</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">niter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_jac</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#transition_sampling.likelihood.optimization.optimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Use basinhopping for global optimization of rxn coords as a linear
combination of CVs.</p>
<p>The reaction coordinate <span class="math notranslate nohighlight">\(r\)</span> is linear combination of <span class="math notranslate nohighlight">\(m\)</span>
collective variables <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> with weights <span class="math notranslate nohighlight">\(\mathbf{\alpha}\)</span>
plus a constant <span class="math notranslate nohighlight">\(\alpha_0\)</span>:</p>
<div class="math notranslate nohighlight">
\[r(\mathbf{x}) = \alpha_0 + \sum_{i=1}^m \alpha_ix_i\]</div>
<p>The probability that a shooting point is on a transition path (TP) is chosen
to be modeled as a non-gaussian bell curve and is given by:</p>
<div class="math notranslate nohighlight">
\[\Pr(TP|\mathbf{x}) = p_0 (1 - \tanh^2(r(\mathbf{x}))\]</div>
<p>This probability is maximized for CVs of accepted shooting points and
minimized for rejected shooting points by optimizing
<span class="math notranslate nohighlight">\(\mathbf{\alpha}\)</span>, <span class="math notranslate nohighlight">\(\alpha_0\)</span>, and <span class="math notranslate nohighlight">\(p_0\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>colvars</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – An (n x m) matrix where n is the number of shooting points and m is the
number of collective variables to include in the reaction</p></li>
<li><p><strong>is_accepted</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>) – A length n array of booleans indicating if the ith state was accepted
or not.</p></li>
<li><p><strong>niter</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code>) – Number of local optimizations to perform with basinhopping. Linearly
scales.</p></li>
<li><p><strong>use_jac</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code>) – True if the analytical jacobian should be used during gradient descent.
Otherwise, the default finite difference approximation will be used.
In most cases, enabling this offers a speedup</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code>[<code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code>]</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>The objective function of the solution and the solution which is an</em></p></li>
<li><p><em>array of length (m+2) of optimized parameters as [p0, alpha0, alphas]</em></p></li>
</ul>
</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>RuntimeWarning</strong> – If the optimization was not successful</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-transition_sampling.likelihood">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-transition_sampling.likelihood" title="Permalink to this headline">¶</a></h2>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="transition_sampling.util.html" class="btn btn-neutral float-right" title="transition_sampling.util package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="transition_sampling.engines.gromacs.html" class="btn btn-neutral float-left" title="transition_sampling.engines.gromacs package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Isaiah Lemmon.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>